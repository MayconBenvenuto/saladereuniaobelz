(()=>{"use strict";var e={147:(e,t,a)=>{var n=a(43),o=a(391);const r={API_BASE_URL:"undefined"!==typeof window?window.location.origin:"",API_TIMEOUT:8e3,API_RETRY_TIMEOUT:12e3,CACHE_DURATION:18e4,CACHE_DURATION_OFFLINE:18e5,MAX_RETRIES:2,RETRY_DELAY:1e3,DEBOUNCE_DELAY:300,PREFETCH_NEXT_DAY:!0,DEBUG:!0},s=function(){if(r.DEBUG){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("[DEBUG]",...t)}},i=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.error("[ERROR]",...t)},l=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.warn("[WARN]",...t)};"undefined"!==typeof window&&(console.log("[CONFIG] Environment:","production"),console.log("[CONFIG] API Base URL:",r.API_BASE_URL),console.log("[CONFIG] Current Origin:",window.location.origin));var c=a(579);const d=()=>navigator.onLine,m="meeting_room_cache",u=e=>{if(!e)return 0;const t=e.split(":");return 60*(parseInt(t[0])||0)+(parseInt(t[1])||0)},p=e=>{let{isOpen:t,onClose:a,selectedSlot:o,onConfirm:r}=e;const[s,i]=(0,n.useState)({name:"",title:"",participants:"",start_time:"",end_time:""});(0,n.useEffect)((()=>{o&&t&&i((e=>({...e,start_time:o.start_time,end_time:o.end_time})))}),[o,t]);return t&&o?(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Agendar Reuni\xe3o"}),(0,c.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,c.jsxs)("div",{className:"booking-form",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Hor\xe1rio Selecionado"}),(0,c.jsxs)("div",{style:{padding:"0.8rem",background:"#e8f5e8",borderRadius:"8px",fontWeight:"600",color:"#2d5a3d"},children:[o.start_time," - ",o.end_time]})]}),(0,c.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.name.trim()?s.title.trim()?s.start_time&&s.end_time?s.start_time>=s.end_time?alert("Hor\xe1rio de fim deve ser posterior ao hor\xe1rio de in\xedcio"):r({name:s.name.trim(),title:s.title.trim(),participants:s.participants.trim(),start_time:s.start_time,end_time:s.end_time}):alert("Hor\xe1rios s\xe3o obrigat\xf3rios"):alert("T\xedtulo da reuni\xe3o \xe9 obrigat\xf3rio"):alert("Nome \xe9 obrigat\xf3rio")},children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Nome do Respons\xe1vel *"}),(0,c.jsx)("input",{type:"text",value:s.name,onChange:e=>i((t=>({...t,name:e.target.value}))),required:!0,placeholder:"Digite seu nome"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"T\xedtulo da Reuni\xe3o *"}),(0,c.jsx)("input",{type:"text",value:s.title,onChange:e=>i((t=>({...t,title:e.target.value}))),required:!0,placeholder:"Ex: Reuni\xe3o de Vendas"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Participantes"}),(0,c.jsx)("textarea",{value:s.participants,onChange:e=>i((t=>({...t,participants:e.target.value}))),placeholder:"Lista de participantes (opcional)",rows:"3"})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Hor\xe1rio de In\xedcio *"}),(0,c.jsx)("input",{type:"time",value:s.start_time,onChange:e=>i((t=>({...t,start_time:e.target.value}))),required:!0})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Hor\xe1rio de T\xe9rmino *"}),(0,c.jsx)("input",{type:"time",value:s.end_time,onChange:e=>i((t=>({...t,end_time:e.target.value}))),required:!0})]})]}),(0,c.jsxs)("div",{className:"form-actions",children:[(0,c.jsx)("button",{type:"button",onClick:a,className:"cancel-button",children:"Cancelar"}),(0,c.jsx)("button",{type:"submit",className:"submit-button",children:"Confirmar Agendamento"})]})]})]})]})}):null},g=()=>{const[e,t]=(0,n.useState)(new Date),[a,o]=(0,n.useState)([]),[g,h]=(0,n.useState)(!1),[v,f]=(0,n.useState)(null),[x,j]=(0,n.useState)(null),[_,E]=(0,n.useState)({start_hour:8,end_hour:20,slot_duration:30}),{loading:y,error:b,request:N,setError:w}=(()=>{const[e,t]=(0,n.useState)(!1),[a,o]=(0,n.useState)(null),[c,d]=(0,n.useState)("online");(0,n.useEffect)((()=>{const e=()=>{d("online"),o(null)},t=()=>{d("offline"),o("Sem conex\xe3o com a internet")};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}),[]);const m=(0,n.useCallback)((async function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.MAX_RETRIES;for(let c=0;c<i;c++)try{const a=0===c?r.API_TIMEOUT:r.API_RETRY_TIMEOUT;s(`Fazendo requisi\xe7\xe3o para: ${e} (tentativa ${c+1}/${i}) - timeout: ${a}ms`);const l=fetch(e,{...n,mode:"cors",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json",...n.headers}}),d=new Promise(((e,t)=>{setTimeout((()=>t(new Error(`Timeout de ${a}ms excedido`))),a)})),m=await Promise.race([l,d]);if(m.ok)return s(`Sucesso na requisi\xe7\xe3o para: ${e}`),o(null),m;if(m.status>=400&&m.status<500)throw new Error(`Erro ${m.status}: ${m.statusText}`);t=new Error(`Erro ${m.status}: ${m.statusText}`)}catch(a){if(t=a,a.message.includes("Timeout"),l(`Tentativa ${c+1}/${i} - ${a.message}`),c<i-1){const e=r.RETRY_DELAY*Math.pow(2,c);await new Promise((t=>setTimeout(t,e)))}}throw t}),[]),u=(0,n.useCallback)((async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(!0),o(null);try{const t=await m(e,n);return await t.json()}catch(a){throw i("Erro na requisi\xe7\xe3o:",a),o(a.message),a}finally{t(!1)}}),[m]);return{loading:e,error:a,request:u,fetchWithRetry:m,setError:o,setLoading:t,connectionStatus:c,isOnline:"online"===c}})(),S=e=>e.toISOString().split("T")[0],C=e=>{w(e)},$=(0,n.useMemo)((()=>{const{start_hour:e,end_hour:t,slot_duration:n}=_;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:18,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;const o=[];console.log("[DEBUG] Gerando slots com agendamentos:",e);for(let r=t;r<a;r++)for(let t=0;t<60;t+=n){const a=`${String(r).padStart(2,"0")}:${String(t).padStart(2,"0")}`,s=t+n;let i=r,l=s;s>=60&&(i++,l=s-60);const c=`${String(i).padStart(2,"0")}:${String(l).padStart(2,"0")}`,d=e.find((e=>{const t=u(a),n=u(c),o=u(e.start_time),r=u(e.end_time);console.log(`[DEBUG] Comparando slot ${a}-${c} (${t}-${n}) com agendamento ${e.start_time}-${e.end_time} (${o}-${r})`);const s=t>=o&&t<r||n>o&&n<=r||t<=o&&n>=r;return s&&console.log(`[DEBUG] \u2705 Conflito encontrado: slot ${a}-${c} ocupado por "${e.title}"`),s}));o.push({start_time:a,end_time:c,available:!d,appointment:d||null})}return console.log("[DEBUG] Slots gerados:",o.length,"total"),console.log("[DEBUG] Slots ocupados:",o.filter((e=>!e.available)).length),o}(a,e,t,n)}),[a,_]),A=(0,n.useCallback)((async()=>{const t=S(e);try{s(`Carregando configura\xe7\xe3o de slots para: ${t}`);const e=await N(`${r.API_BASE_URL}/api/availability/${t}`,{method:"GET"});e&&e.slots_config&&(E(e.slots_config),s("Configura\xe7\xe3o de slots atualizada:",e.slots_config))}catch(b){i("Erro ao carregar configura\xe7\xe3o de slots:",b)}}),[e,N]),T=(0,n.useCallback)((async()=>{const t=S(e),a=(e=>{try{const t=localStorage.getItem(`${m}_${e}`);if(t){const{data:e,timestamp:a}=JSON.parse(t),n=d()?r.CACHE_DURATION:r.CACHE_DURATION_OFFLINE;if(Date.now()-a<n)return e}}catch(t){console.warn("Erro ao ler cache:",t)}return null})(t);if(a)return o(a),void s("Dados carregados do cache para:",t);try{s(`Carregando agendamentos para: ${t}`);const e=await N(`${r.API_BASE_URL}/api/appointments?date=${t}`,{method:"GET"});s(`Dados recebidos para ${t}:`,e);const a=Array.isArray(e)?e:[];console.log("[DEBUG] Appointments processados:",a),o(a),((e,t)=>{try{localStorage.setItem(`${m}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch(a){console.warn("Erro ao salvar cache:",a)}})(t,a)}catch(b){i("Erro ao carregar agendamentos:",b);const a=localStorage.getItem(`${m}_${t}`);if(a)try{const{data:e}=JSON.parse(a);o(e||[]),C("Usando dados em cache (pode estar desatualizado).")}catch{o([]),C("Erro de conex\xe3o. N\xe3o foi poss\xedvel carregar os dados.")}else o([]),C("Erro de conex\xe3o. Tente novamente.")}}),[e,N]);(0,n.useEffect)((()=>{A(),T()}),[A,T]),(0,n.useEffect)((()=>{console.log("Verificando acesso \xe0 imagem...")}),[]);const R=a=>{const n=new Date(e);n.setDate(n.getDate()+a),t(n)};return(0,c.jsxs)("div",{className:"app",children:[(0,c.jsx)("div",{className:"header",children:(0,c.jsx)("div",{className:"header-content",children:(0,c.jsxs)("div",{className:"logo-container",children:[(0,c.jsx)("img",{src:"/logo-belz.png",alt:"Belz Logo",className:"logo",onError:e=>{e.target.style.display="none"}}),(0,c.jsx)("h1",{children:"Agende sua Reuni\xe3o"})]})})}),(0,c.jsxs)("div",{className:"main-content",children:[!d()&&(0,c.jsx)("div",{className:"notification error",style:{position:"relative",marginBottom:"1rem"},children:"\u26a0\ufe0f Modo offline - Dados podem estar desatualizados"}),(0,c.jsxs)("div",{className:"date-navigation",children:[(0,c.jsx)("button",{className:"nav-button",onClick:()=>R(-1),disabled:y,children:"\u2039"}),(0,c.jsxs)("div",{className:"current-date",children:[(0,c.jsx)("h2",{children:(D=e,D.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}),(0,c.jsx)("input",{type:"date",value:S(e),onChange:e=>t(new Date(e.target.value+"T00:00:00")),style:{padding:"0.5rem",border:"2px solid #ddd",borderRadius:"8px",fontSize:"1rem"}})]}),(0,c.jsx)("button",{className:"nav-button",onClick:()=>R(1),disabled:y,children:"\u203a"})]}),y&&(0,c.jsxs)("div",{className:"loading",children:[(0,c.jsx)("div",{className:"spinner"}),"Carregando agendamentos..."]}),b&&(0,c.jsxs)("div",{className:"notification error",style:{position:"relative",marginBottom:"1rem"},children:[(0,c.jsxs)("span",{children:["\u26a0\ufe0f ",b]}),(0,c.jsx)("button",{onClick:()=>w(null),children:"\xd7"})]}),x&&(0,c.jsx)("div",{className:"notification success",style:{position:"relative",marginBottom:"1rem"},children:(0,c.jsxs)("span",{children:["\u2705 ",x]})}),a.length>0&&(0,c.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,c.jsxs)("h3",{style:{marginBottom:"1rem",color:"#2a5298"},children:["Agendamentos do Dia (",a.length,")"]}),(0,c.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1rem"},children:a.map((e=>(0,c.jsxs)("div",{style:{background:"white",padding:"1rem",borderRadius:"8px",border:"1px solid #ddd",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,c.jsx)("h4",{style:{margin:"0 0 0.5rem 0",color:"#2a5298"},children:e.title}),(0,c.jsxs)("p",{style:{margin:"0.25rem 0",fontSize:"0.9rem"},children:[(0,c.jsx)("strong",{children:"Hor\xe1rio:"})," ",e.start_time," - ",e.end_time]}),(0,c.jsxs)("p",{style:{margin:"0.25rem 0",fontSize:"0.9rem"},children:[(0,c.jsx)("strong",{children:"Respons\xe1vel:"})," ",e.name]}),e.participants&&(0,c.jsxs)("p",{style:{margin:"0.25rem 0",fontSize:"0.9rem"},children:[(0,c.jsx)("strong",{children:"Participantes:"})," ",e.participants]}),e.description&&(0,c.jsxs)("p",{style:{margin:"0.25rem 0",fontSize:"0.9rem"},children:[(0,c.jsx)("strong",{children:"Descri\xe7\xe3o:"})," ",e.description]})]},e.id)))})]}),(0,c.jsx)("div",{className:"calendar-container",children:(0,c.jsx)("div",{className:"time-slots",children:$.map(((e,t)=>(0,c.jsxs)("div",{className:"time-slot "+(e.available?"available":"occupied"),onClick:()=>(e=>{e.available&&(f(e),h(!0))})(e),children:[(0,c.jsxs)("div",{className:"time-range",children:[e.start_time," - ",e.end_time]}),e.available?(0,c.jsx)("div",{className:"slot-status",children:"Dispon\xedvel"}):(0,c.jsxs)("div",{className:"appointment-info",children:[(0,c.jsx)("div",{className:"appointment-title",children:e.appointment.title}),(0,c.jsx)("div",{className:"appointment-name",children:e.appointment.name})]})]},t)))})})]}),(0,c.jsx)(p,{isOpen:g,onClose:()=>{h(!1),f(null)},selectedSlot:v,onConfirm:async t=>{try{const n={name:t.name,title:t.title,participants:t.participants,date:S(e),start_time:t.start_time,end_time:t.end_time};s("Criando agendamento:",n),await N(`${r.API_BASE_URL}/api/appointments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),j("Agendamento criado com sucesso!"),setTimeout((()=>j(null)),3e3),h(!1),f(null);const i=S(e);localStorage.removeItem(`${m}_${i}`),console.log("[DEBUG] Recarregando agendamentos ap\xf3s cria\xe7\xe3o...");try{const e=Date.now(),t=await N(`${r.API_BASE_URL}/api/appointments?date=${i}&_cb=${e}`,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[DEBUG] Dados frescos recebidos:",t);const a=Array.isArray(t)?t:[];o(a)}catch(a){console.error("[DEBUG] Erro ao recarregar, tentando m\xe9todo normal:",a),await T()}}catch(b){i("Erro ao criar agendamento:",b),C("Erro ao criar agendamento. Tente novamente.")}}})]});var D};o.createRoot(document.getElementById("root")).render((0,c.jsx)(n.StrictMode,{children:(0,c.jsx)(g,{})}))}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.m=e,(()=>{var e=[];a.O=(t,n,o,r)=>{if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],r=e[d][2];for(var i=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(a.O).every((e=>a.O[e](n[l])))?n.splice(l--,1):(i=!1,r<s&&(s=r));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,o,r]}})(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var o,r,s=n[0],i=n[1],l=n[2],c=0;if(s.some((t=>0!==e[t]))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(l)var d=l(a)}for(t&&t(n);c<s.length;c++)r=s[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self.webpackChunkfrontend=self.webpackChunkfrontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=a.O(void 0,[773],(()=>a(147)));n=a.O(n)})();
//# sourceMappingURL=main.ede756de.js.map