<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöë Teste de Emerg√™ncia - Imagem da Sala</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .test-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #cce7ff; color: #004085; border: 1px solid #b3d7ff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üöë Teste de Emerg√™ncia - Imagem da Sala</h1>
        
        <div id="status-container">
            <div class="status info">üîç Testando carregamento...</div>
        </div>
        
        <h2>Teste 1: Imagem direta</h2>
        <img src="/sala.jpg" alt="Teste Sala" class="test-image" id="test1">
        
        <h2>Teste 2: Imagem com cache buster</h2>
        <img src="/sala.jpg?v=emergency" alt="Teste Sala Cache Buster" class="test-image" id="test2">
        
        <h2>Teste 3: Verificar se o arquivo existe</h2>
        <button onclick="testFileExists()" style="padding: 10px 20px; font-size: 16px;">üîç Verificar Arquivo</button>
        
        <h2>Teste 4: Service Worker Status</h2>
        <div id="sw-info" class="status info">Verificando...</div>
        
        <h2>Informa√ß√µes de Debug</h2>
        <div id="debug-info">
            <strong>URL da p√°gina:</strong> <span id="page-url"></span><br>
            <strong>Largura da tela:</strong> <span id="screen-width"></span>px<br>
            <strong>User Agent:</strong> <span id="user-agent"></span>
        </div>
    </div>

    <script>
        let testsCompleted = 0;
        let testsPassed = 0;
        
        function updateStatus() {
            const container = document.getElementById('status-container');
            if (testsCompleted === 2) {
                if (testsPassed === 2) {
                    container.innerHTML = '<div class="status success">‚úÖ Todos os testes PASSARAM! A imagem est√° funcionando.</div>';
                } else if (testsPassed === 1) {
                    container.innerHTML = '<div class="status info">‚ö†Ô∏è Apenas 1 teste passou. Pode haver problemas de cache.</div>';
                } else {
                    container.innerHTML = '<div class="status error">‚ùå TODOS os testes FALHARAM! A imagem n√£o est√° carregando.</div>';
                }
            }
        }
        
        function testImage(imageId, testName) {
            const img = document.getElementById(imageId);
            
            img.onload = function() {
                console.log(`‚úÖ ${testName}: Sucesso`);
                testsCompleted++;
                testsPassed++;
                updateStatus();
            };
            
            img.onerror = function() {
                console.error(`‚ùå ${testName}: Falhou`);
                testsCompleted++;
                updateStatus();
            };
        }
        
        function testFileExists() {
            fetch('/sala.jpg', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        alert('‚úÖ Arquivo sala.jpg EXISTS e est√° acess√≠vel!');
                    } else {
                        alert(`‚ùå Arquivo sala.jpg retornou status: ${response.status}`);
                    }
                })
                .catch(error => {
                    alert(`‚ùå Erro ao verificar arquivo: ${error.message}`);
                });
        }
        
        function checkServiceWorker() {
            const swInfo = document.getElementById('sw-info');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations()
                    .then(registrations => {
                        if (registrations.length > 0) {
                            swInfo.innerHTML = `‚úÖ Service Worker ativo: ${registrations.length} encontrado(s)`;
                            swInfo.className = 'status success';
                        } else {
                            swInfo.innerHTML = '‚ö†Ô∏è Nenhum Service Worker registrado';
                            swInfo.className = 'status info';
                        }
                    })
                    .catch(error => {
                        swInfo.innerHTML = `‚ùå Erro ao verificar SW: ${error.message}`;
                        swInfo.className = 'status error';
                    });
            } else {
                swInfo.innerHTML = '‚ùå Service Worker n√£o suportado';
                swInfo.className = 'status error';
            }
        }
        
        // Preencher informa√ß√µes de debug
        document.getElementById('page-url').textContent = window.location.href;
        document.getElementById('screen-width').textContent = window.innerWidth;
        document.getElementById('user-agent').textContent = navigator.userAgent;
        
        // Executar testes
        testImage('test1', 'Teste 1');
        testImage('test2', 'Teste 2');
        checkServiceWorker();
        
        console.log('üîç Teste de emerg√™ncia iniciado');
    </script>
</body>
</html>
